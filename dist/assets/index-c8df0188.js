import{bb as h,d as ie,m as i,S as me,p as pe,o as E,a as F,A as l,w as t,f as s,b7 as C,Z as m,t as S,x as $,e as D,g as ce,F as B,ag as fe,an as G,bc as U,a1 as ve,a2 as _e,U as ge,b8 as be,$ as ye,a0 as we,O as Ve}from"./index-711bad6c.js";import{E as Ce,a as he}from"./el-checkbox-fc98ec04.js";import{E as ke}from"./el-drawer-c6f2e5dd.js";import"./el-overlay-569e09b0.js";import{E as Ue}from"./el-pagination-ee604fa6.js";import{E as xe,a as Ee,b as Se}from"./el-message-0ef3f67b.js";/* empty css                   */import{E as ze}from"./el-button-31d35a19.js";import{u as Re}from"./setting-cd598a4c.js";import"./vnode-27e25623.js";const Ie=(n,u,_)=>h.get(`/admin/acl/user/${n}/${u}/?username=${_}`),Ne=n=>n.id?h.put("/admin/acl/user/update",n):h.post("/admin/acl/user/save",n),qe=n=>h.get("/admin/acl/user/toAssign/"+n),Ae=n=>h.post("/admin/acl/user/doAssignRole",n),Oe=n=>h.delete("/admin/acl/user/remove/"+n),Pe=n=>h.delete("/admin/acl/user/batchRemove",{data:n}),Te=n=>(ye("data-v-c03967b7"),n=n(),we(),n),Le={style:{flex:"auto"}},je=Te(()=>S("h4",null,"分配角色",-1)),Fe={style:{flex:"auto"}},$e=ie({__name:"index",setup(n){let u=i(1),_=i(5),q=i(0),x=i([]),f=i(!1),c=i(!1),k=i([]),g=i([]),r=me({username:"",name:"",password:""}),z=i([]);pe(()=>{w()});let b=i(),y=i(""),A=Re();const w=async(o=1)=>{u.value=o;let e=await Ie(u.value,_.value,y.value);e.code===200&&(q.value=e.data.total,x.value=e.data.records)},M=()=>{w()},H=()=>{f.value=!0,Object.assign(r,{id:0,username:"",name:"",password:""}),G(()=>{b.value.clearValidate("username"),b.value.clearValidate("name"),b.value.clearValidate("password")})},Z=o=>{f.value=!0,Object.assign(r,o),G(()=>{b.value.clearValidate("username"),b.value.clearValidate("name")})},J=async()=>{b.value.validate(),(await Ne(r)).code===200?(f.value=!1,U({type:"success",message:r.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,U({type:"error",message:r.id?"更新失败":"添加失败"}))},K=()=>{f.value=!1},Q={username:[{required:!0,trigger:"blur",validator:(o,e,d)=>{e.trim().length>=5?d():d(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,d)=>{e.trim().length>=5?d():d(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,d)=>{e.trim().length>=5?d():d(new Error("用户密码至少六位"))}}]},W=async o=>{c.value=!0,Object.assign(r,o);let e=await qe(r.id);e.code===200&&(k.value=e.data.allRolesList,g.value=e.data.assignRoles,c.value=!0)},R=i(!1),I=i(!0),X=o=>{g.value=o?k.value:[],I.value=!1},Y=o=>{const e=o.length;R.value=e===k.value.length,I.value=e>0&&e<k.value.length},ee=async()=>{let o={userId:r.id,roleIdList:g.value.map(d=>d.id)};(await Ae(o)).code===200&&(U({type:"success",message:"分配职务成功"}),c.value=!1,w(u.value))},le=async o=>{(await Oe(o)).code===200&&(U({type:"success",message:"删除成功"}),w(x.value.length>1?u.value:u.value-1))},ae=o=>{z.value=o},te=async()=>{let o=z.value.map(d=>d.id);(await Pe(o)).code===200&&(U({type:"success",message:"删除成功"}),w(x.value.length>1?u.value:u.value-1))},oe=()=>{w(),y.value=""},se=()=>{A.refsh=!A.refsh};return(o,e)=>{const d=ve,V=_e,p=ze,N=ge,O=be,v=xe,re=Ee,ne=Se,de=Ue,P=ke,T=Ce,ue=he;return E(),F(B,null,[l(O,{style:{height:"80px"}},{default:t(()=>[l(N,{inline:!0,class:"form"},{default:t(()=>[l(V,{label:"用户名:"},{default:t(()=>[l(d,{placeholder:"请你输入搜索用户名",modelValue:s(y),"onUpdate:modelValue":e[0]||(e[0]=a=>C(y)?y.value=a:y=a)},null,8,["modelValue"])]),_:1}),l(V,null,{default:t(()=>[l(p,{type:"primary",size:"default",disabled:!s(y).length,onClick:oe},{default:t(()=>[m(" 搜索 ")]),_:1},8,["disabled"]),l(p,{size:"default",onClick:se},{default:t(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(O,{style:{margin:"10px 0"}},{default:t(()=>[l(p,{type:"primary",size:"default",onClick:H},{default:t(()=>[m(" 添加用户 ")]),_:1}),l(p,{type:"danger",size:"default",disabled:!s(z).length,onClick:te},{default:t(()=>[m(" 批量删除 ")]),_:1},8,["disabled"]),l(ne,{style:{margin:"10px 0"},border:"",data:s(x),onSelectionChange:ae},{default:t(()=>[l(v,{type:"selection",align:"center"}),l(v,{label:"#",align:"center",type:"index"}),l(v,{label:"id",align:"center",prop:"id"}),l(v,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(v,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),l(v,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(v,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(v,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(v,{label:"操作",width:"300px",align:"center"},{default:t(({row:a,$index:L})=>[l(p,{size:"small",icon:"User",onClick:j=>W(a)},{default:t(()=>[m(" 分配角色 ")]),_:2},1032,["onClick"]),l(p,{type:"primary",size:"small",icon:"Edit",onClick:j=>Z(a)},{default:t(()=>[m(" 编辑 ")]),_:2},1032,["onClick"]),l(re,{title:`你确定删除${a.username}`,width:"260px",onConfirm:j=>le(a.id)},{reference:t(()=>[l(p,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[m(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(de,{"current-page":s(u),"onUpdate:currentPage":e[1]||(e[1]=a=>C(u)?u.value=a:u=a),"page-size":s(_),"onUpdate:pageSize":e[2]||(e[2]=a=>C(_)?_.value=a:_=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper, -> , sizes, total",total:s(q),onCurrentChange:w,onSizeChange:M},null,8,["current-page","page-size","total"])]),_:1}),l(P,{modelValue:s(f),"onUpdate:modelValue":e[6]||(e[6]=a=>C(f)?f.value=a:f=a)},{header:t(()=>[S("h4",null,$(s(r).id?"更新用户":"添加用户"),1)]),default:t(()=>[l(N,{model:s(r),rules:Q,ref_key:"formRef",ref:b},{default:t(()=>[l(V,{label:"用户姓名",prop:"username"},{default:t(()=>[l(d,{placeholder:"请您输入用户姓名",modelValue:s(r).username,"onUpdate:modelValue":e[3]||(e[3]=a=>s(r).username=a)},null,8,["modelValue"])]),_:1}),l(V,{label:"用户昵称",prop:"name"},{default:t(()=>[l(d,{placeholder:"请您输入用户昵称",modelValue:s(r).name,"onUpdate:modelValue":e[4]||(e[4]=a=>s(r).name=a)},null,8,["modelValue"])]),_:1}),s(r).id?ce("",!0):(E(),D(V,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(d,{placeholder:"请您输入用户密码",modelValue:s(r).password,"onUpdate:modelValue":e[5]||(e[5]=a=>s(r).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[S("div",Le,[l(p,{onClick:K},{default:t(()=>[m("取消")]),_:1}),l(p,{type:"primary",onClick:J},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"]),l(P,{modelValue:s(c),"onUpdate:modelValue":e[11]||(e[11]=a=>C(c)?c.value=a:c=a)},{header:t(()=>[je]),default:t(()=>[l(N,null,{default:t(()=>[l(V,{label:"用户姓名"},{default:t(()=>[l(d,{modelValue:s(r).username,"onUpdate:modelValue":e[7]||(e[7]=a=>s(r).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),l(V,{label:"职位列表"},{default:t(()=>[l(T,{modelValue:R.value,"onUpdate:modelValue":e[8]||(e[8]=a=>R.value=a),indeterminate:I.value,onChange:X},{default:t(()=>[m(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),l(ue,{modelValue:s(g),"onUpdate:modelValue":e[9]||(e[9]=a=>C(g)?g.value=a:g=a),onChange:Y},{default:t(()=>[(E(!0),F(B,null,fe(s(k),(a,L)=>(E(),D(T,{key:L,label:a},{default:t(()=>[m($(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[S("div",Fe,[l(p,{onClick:e[10]||(e[10]=a=>C(c)?c.value=!1:c=!1)},{default:t(()=>[m("取消")]),_:1}),l(p,{type:"primary",onClick:ee},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"])],64)}}});const ll=Ve($e,[["__scopeId","data-v-c03967b7"]]);export{ll as default};
